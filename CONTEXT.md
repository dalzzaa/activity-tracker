# 프로젝트 컨텍스트 (Project Context)

이 파일은 Gemini Code Assist가 프로젝트를 더 잘 이해하고, 일관성 있고 정확한 코드 제안을 할 수 있도록 돕기 위한 컨텍스트 정보를 담고 있습니다.

## 1. 프로젝트 개요

- **프로젝트 이름:** Activity Tracking
- **목표:** 사용자가 수행한 활동들을 **개인 스마트폰** 환경에서 관리할 수 있는 싱글 페이지 애플리케이션(SPA) 형태의 웹 앱 개발
- **아키텍처 원칙:** 개인 전용(Single-user), 오프라인 우선(Offline-first), 완전한 클라이언트 사이드(Fully Client-Side) 앱
    : 단, 경로 스냅(snap-to-road)과 같이 사용자 경험을 크게 향상시키는 기능에 한해 인터넷 연결을 통한 외부 서비스 사용을 허용한다.
- **주요 기능:**
    - index.html로 보여주는 초기화면에는 **Activity 기록을 보여줄 수 있는 캘린더 뷰**를 보여준다.
    - **Activity 기록을 보여줄 수 있는 캘린더 뷰**
        -- 현재 달(month)의 달력을 기본으로 보여준다
            : 달력의 상단에는 연도(year) 와 월(month)를 보여준다.
                -- 연도와 월의 좌우에 버튼을 두어 이전 년도와 이후 년도, 이전 달과 이후 달로 이동할 수 있도록 한다
                    : 연도 또는 달이 변경되면, calendar 내용도 해당 년도와 월에 해당되는 내용을 변경한다.
        -- calender 날짜는 요일을 먼저 보여준 후에 그 아래로 요일에 맞게 날짜를 보여준다. 
            : 요일은 일요일부터 보여준다.
            : 날짜의 오른쪽에는 activity를 등록할 수 있는 버튼('+' 버튼)을 보여준다.
                -- 등록 버튼을 선택하면 **activity 등록 상세 뷰**를 보여준다.
            : 등록된 activity가 있는 경우 날짜 아래에 activity 명을 보여준다.
                -- activity 명은 날짜 칸에 맞게 자동으로 줄여서 표현되어야 한다.
                -- activity 명 오른쪽에는 '..' 버튼을 두어, click시 '삭제' 팝업메뉴를 보여준다.
                    :: 삭제 팝업메뉴 선택시 등록된 activity 삭제여부를 확인한 후에, 사용자가 동의하면 삭제하도록 한다.
        -- activity 등록 버튼을 선택하면 **activity 내용을 보여주는 상세 뷰**를 보여준다
    - **activity 내용을 보여주는 상세 뷰**
        -- 새로운 page를 생성하여 그 page에서 보여준다
        -- 상단에는 선택된 날짜에 대해 '2025. 09. 01. 월.' 형식으로 보여준다.
        -- 날짜 아래에는 activity 명을 보여준다.
            : activity 명은 항상 수정 가능한 입력창(`input`)으로 표시되며, 그 옆의 '저장' 버튼을 통해 언제든지 내용을 저장할 수 있다.
        -- activity 명 아래에는 '활동 기록 제어' : [시작][중지][종료] 버튼을 보여준다.
            : 활동이 아직 저장되지 않은 상태(새로운 활동 등록 시)에서는 이 버튼들이 비활성화된다.
            : 활동 제목을 입력하고 '저장' 버튼을 눌러 활동이 생성되어야 버튼이 활성화된다.
        -- **활동 기록 제어** 아래에는 지도를 보여주며, activity 활동 중에 이동한 경로를 표시해 준다.
            : 이전에 저장된 이동 경로가 있다면 상세 뷰가 열릴 때 지도에 자동으로 표시된다.
        -- **activity 내용을 보여주는 상세 뷰** 가 보여지고, 활동 기록 제어가 시작된 상태인 경우, 스마트폰의 이동 경로를 계속해서 기록한다.
            : '시작' 버튼을 누르면 `Geolocation API`의 `watchPosition`을 통해 위치 추적을 시작한다.
            : 위도, 경도 변화를 감시하여 변화가 있을 때마다 좌표를 기록하고, 지도 위에 실시간으로 경로를 업데이트한다.
            : 수집된 GPS 좌표는 외부 라우팅 서비스(OSRM)를 통해 실제 도로에 맞는 경로로 변환(경로 스냅)되어 지도 위에 파란색 선(`Polyline`)으로 표시된다. 이 기능은 인터넷 연결이 필요하다.
            : **참고**: 웹 브라우저의 제약으로 인해, 앱이 백그라운드로 전환되거나 화면이 꺼지면 `watchPosition`의 동작이 멈추거나 간헐적으로만 동작할 수 있다. 이는 배터리 절약을 위한 브라우저/OS 정책이며, 완전한 백그라운드 추적을 위해서는 Service Worker와 같은 고급 기술이나 네이티브 앱 기능이 필요하다. 현재 버전에서는 앱이 화면에 활성화되어 있을 때의 추적을 보장한다.
            : 추적 시작 시 경로의 첫 위치에 '시작' 마커를 표시하고, 이동 중에는 실시간 '현재 위치' 마커를 보여준다.
            : '종료' 버튼을 누르면 위치 추적을 멈춘다.
            : '저장' 버튼을 누르면 현재까지 기록된 이동 경로가 활동 데이터와 함께 IndexedDB에 저장된다.
        -- 활동과 관련하여 지도에 등록한 메모가 있다면, 해당 위치에 메모가 있음을 표현해 준다.
            : 메모 표현은 해당 위치에 등록된 사진이 있는 경우에는 썸네일(최대4개 사진)을 보여준다.
            : 해당 위치에 등록된 사진이 없는 경우에는 메모를 나타내는 아이콘을 보여준다.
        -- 메모를 선택하면, **메모내용을 보여주는 상세 뷰**를 보여준다.
            : 메모가 등록되지 않은 지도위의 특정위치를 길게 누르면(마우스 이용시 클릭), **메모내용을 보여주는 상세 뷰**를 보여준다.
            : 메모가 작성된 위치 및 메모내용을 저장하여, **activity 상세 뷰**를 보여줄때 함께 보여준다.
    - **activity 등록 상세 뷰**
        -- **activity 내용을 보여주는 상세 뷰** 의 내용과 같게 표현한다.
            : 아직 이동경로가 저장되지 않았고, activity가 시작되지 않았으므로, 지도에 경로표시가 되지 않은 상태로 보여준다. 이때, 현재 위지는 스마트폰 현재 위치를 나타내야 한다.
    - **메모내용을 보여주는 상세 뷰**
        -- **activity 상세 뷰** 의 앞에 Modal form 형식으로 보여준다
        -- 위치에 대한 정보(위도, 경도)를 보여준다.
            : 해당 위치의 주소를 보여줄 수 있으면 위도,경도 대신에 주소를 보여준다.
        -- 메모 내용을 보여주고 내용을 작성, 수정 할 수 있도록하며, 저장버튼을 보여준다.
        -- 메모 밑에는 '사진 찍기' 버튼과 '사진 선택' 버튼을 보여준다.
            : '사진 찍기' 버튼을 선택하면 스마트폰에서는 사진을 찍고, 찍은 사진 정보(파일 패스)를 메모와 관련된 정보로 저장한다.
            : 사진 선택은 local에 저장된 사진을 선택할 수 있도록 하고, 선택된 사진은 파일 패스 정보를 메모와 관련된 정보로 저장한다.
        -- 메모 밑에 보여지는 사진은 여러 개를 등록할 수 있으며, 사진찍기 와 사진선택 버튼을 이용하여 등록한다.
---

## 2. 기술 스택 및 의존성 (Tech Stack & Dependencies)

- **프론트엔드/아키텍처:**
    - **순수 JavaScript (Vanilla JS)**, HTML5, CSS3.
    - **모바일 웹 환경 최적화**: 스마트폰 환경에서의 사용 편의성을 최우선으로 고려합니다 (반응형 디자인, 터치 이벤트 처리).
- **데이터베이스(로컬):**
   - **IndexedDB**: 모든 구조화된 데이터(활동 기록, 경로 좌표, 위치 마커 데이터) 및 사진파일 저장을 위한 주요 데이터베이스로 사용.
- **지도/위치 기능:**
    - **Leaflet.js**: 지도 표시 및 경로/마커 시각화.
    - **Geolocation API**: 사용자의 현재 위치 정보 획득.

- **데이터 구조 및 형식:**
    - **데이터 형식**: 모든 로컬 저장 데이터는 JSON 기반 객체입니다.
    - **좌표 형식**: 모든 좌표는 [위도, 경도](latitude, longitude) 형식으로 저장됩니다.
    - **Activity 모델(IndexedDB)**: activityId(주 키), title, date, path_coordinates(경로 좌표 배열), location_markers(위치 지점 배열).
    - **Loaction Marker(IndexedDB)**: latitude, longitude, location_name, memo_data_key(IndexedDB 내 메모 객체를 참조하는 키), image_data_key(IndexedDB 내 사진 객체를 참조하는 키)
- **테스트:** Jest (유틸리티 함수 및 로직 테스트에 중점)
- **주요 라이브러리:**
    - `date-fns`: 날짜 처리 및 캘린더 구현.
    - Leaflet 라이브러리(지도관련)

---

## 3. 코딩 컨벤션 (Coding Conventions)

- **스타일 가이드:** Airbnb JavaScript Style Guide (순수 JS 환경에 맞춰 적용)
- **네이밍:**
    - 변수/함수: camelCase (예: `handleMapClick`)
    - DOM 요소 선택 변수: **`$` 접두사 사용** (예: $\text{\$mapContainer}$)
- **선호 사항:**
    - **모듈 패턴**을 사용하여 코드를 기능별로 분리합니다.
    - **ES Modules** 문법 (`import`/`export`)을 사용합니다.
    - **로컬 데이터 저장 실패** 에 대한 사용자 피드백 로직을 강조합니다
---

## 4. 주요 파일 구조 (Key File Structure)

- `index.html`: 메인 페이지 (SPA의 시작점, $\text{Leaflet}$ CSS 포함).
- `src/`: JavaScript 및 CSS 파일
    - `src/main.js`: 앱 초기화 및 메인 로직.
    - `src/db/indexedDB.js`: 모든 데이터베이스 CRUD 작업을 담당하는 핵심 로직(IndexedDB전용).
    - **`src/map/mapHandler.js`**: Leaflet 인스턴스 초기화, 지도 객체 관리, 경로/마커 렌더링 및 Geolocation 추적 로직 통합.
    - `src/ui/`: DOM 조작 관련 함수 및 뷰 렌더링(모바일 터치 이벤트 처리 포함).
    - `src/utils/`: 범용 유틸리티 함수.

---

## 5. 현재 목표 (Current Objective)

- 완전한 로컬 기반의 Activity 관리 화면(조회, 등록, 수정, 삭제 기능 포함)을 순수 JavaScript와 IndexedDB를 사용하여 개인 스마트폰 환경에서 안정적으로 구현을 완료하는 것입니다.